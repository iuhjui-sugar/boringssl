{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "36ee2a48_f39cfc84",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5005
      },
      "writtenOn": "2023-06-09T18:50:43Z",
      "side": 1,
      "message": "We have non-perlasm assembly too. Presumably they might need these annotations too?\n\nCan the change in x86_64-xlate contain some comments about the semantics of this directive and where it\u0027s needed? Is cet.h going to exist in the environments that we care about?\n\nCan Intel SDE test this? In general, how would we notice if we added assembly that wasn\u0027t compliant with this?",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "445ee18f_a75b2ab2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 14196
      },
      "writtenOn": "2023-06-13T16:00:35Z",
      "side": 1,
      "message": "I suppose to initially answer, Yes, the non-perlasm will also need annotations. \n\nIntel SDE can test this, so after a chat with david and waiting for the include changes that may simplify this, I\u0027ll take a look at addressing both and seeing if we can have go tests fire it through the SDE",
      "parentUuid": "36ee2a48_f39cfc84",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8c1ab132_4ad1d4e4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-06-13T19:40:49Z",
      "side": 1,
      "message": "SDE bots now exist under \"choose tryjobs\". But looks like they don\u0027t work. :-(\nhttps://ci.chromium.org/ui/p/boringssl/builders/try/linux_sde/b8778376558735492785/overview\n\nI think we need to figure out the ACLs on the `chrome-boringssl-sde` bucket and make it so the CQ can access it too. I\u0027ll try to figure out who owns that ACL. In the meantime, you could probably test `all_tests.go` manually with a local SDE install.\n\nRe cet.h, that header doesn\u0027t seem to do much, but it\u0027s probably okay to assume for now that, if your toolchain knows what CET is, it ships the header? (If the C code isn\u0027t built with CET, it doesn\u0027t matter if the assembly is.)\nhttps://github.com/llvm/llvm-project/blob/adcdc9cc3740adba3577b328fa3ba492cbccd3a5/clang/lib/Headers/cet.h\n\nIf we ever run into trouble with it, we can always just encode `endbr64` manually, and then also add the `.note.gnu.property` section ourselves.",
      "parentUuid": "445ee18f_a75b2ab2",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "191dd650_7e2bfe7a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-06-15T02:58:13Z",
      "side": 1,
      "message": "ACL issues resolved! It\u0027s not fast, but you can trigger the bot now.\nhttps://ci.chromium.org/ui/p/boringssl/builders/try/linux_sde/b8778346779344184257/overview",
      "parentUuid": "8c1ab132_4ad1d4e4",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b7c53d1e_e513a544",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 14196
      },
      "writtenOn": "2023-07-03T12:33:08Z",
      "side": 1,
      "message": "So effectively __CET__ is defined by the compiler if it supports and has \u003ccet.h\u003e which was added to gcc and clang by intel.  \n\nFor windows for the moment, it\u0027s a no-op.\n\nI\u0027ve moved the definition into asm_base.h and annotated the fiat assembler files\nand the start of the function in the same manner as the perlasm ones.",
      "parentUuid": "191dd650_7e2bfe7a",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "052ddd7f_deb519a9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 14196
      },
      "writtenOn": "2023-07-03T14:41:14Z",
      "side": 1,
      "message": "So pulling this onto a linux machine, and adding the -fcf-protection flag to the compiler flags in cmake we do end up with the endbr instructions in the correct place, and the binaries get correctly tagged as having IBT:\n\nbbe@bbe-glinux1:~/boringssl/build$ readelf -n crypto/fipsmodule/CMakeFiles/fipsmodule.dir/aesni-x86_64-linux.S.o\n\nDisplaying notes found in: .note.gnu.property\n  Owner                Data size \tDescription\n  GNU                  0x00000010\tNT_GNU_PROPERTY_TYPE_0\n      Properties: x86 feature: IBT, SHSTK\nbbe@bbe-glinux1:~/boringssl/build$ objdump --disassemble crypto/fipsmodule/CMakeFiles/fipsmodule.dir/aesni-x86_64-linux.S.o | grep endbr\n       0:\tf3 0f 1e fa          \tendbr64\n      50:\tf3 0f 1e fa          \tendbr64\n     740:\tf3 0f 1e fa          \tendbr64\n     ca0:\tf3 0f 1e fa          \tendbr64\n    15f0:\tf3 0f 1e fa          \tendbr64\n    1f70:\tf3 0f 1e fa          \tendbr64\n    1fe0:\tf3 0f 1e fa          \tendbr64\nbbe@bbe-glinux1:~/boringssl/build$ readelf -n pki/CMakeFiles/pki.dir/input.cc.o \n\nDisplaying notes found in: .note.gnu.property\n  Owner                Data size \tDescription\n  GNU                  0x00000010\tNT_GNU_PROPERTY_TYPE_0\n      Properties: x86 feature: IBT, SHSTK\nbbe@bbe-glinux1:~/boringssl/build$ objdump --disassemble pki/CMakeFiles/pki.dir/input.cc.o | grep endbr\n   0:\tf3 0f 1e fa          \tendbr64\n  4e:\tf3 0f 1e fa          \tendbr64\n  8c:\tf3 0f 1e fa          \tendbr64\n  de:\tf3 0f 1e fa          \tendbr64\n 116:\tf3 0f 1e fa          \tendbr64\n 142:\tf3 0f 1e fa          \tendbr64\n 1d9:\tf3 0f 1e fa          \tendbr64\n 206:\tf3 0f 1e fa          \tendbr64\n 244:\tf3 0f 1e fa          \tendbr64\n 29a:\tf3 0f 1e fa          \tendbr64\n 30e:\tf3 0f 1e fa          \tendbr64\n 32a:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64\n   0:\tf3 0f 1e fa          \tendbr64",
      "parentUuid": "b7c53d1e_e513a544",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2fbeb31f_6a5498db",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 14196
      },
      "writtenOn": "2023-07-03T14:42:21Z",
      "side": 1,
      "message": "of note at least on out linux environments we can\u0027t build an enforcing binary without linking in a libc / libc++ build with -fcf-protection as this is another all or nothing thing.",
      "parentUuid": "052ddd7f_deb519a9",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "436cecaf_75e7f4f5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 14196
      },
      "writtenOn": "2023-07-03T14:55:18Z",
      "side": 1,
      "message": "And (with the compiler flags changed to add -fcf-protection) I just confirmed that all the elf objects end up with the IBT and SHSTK properties set, so assuming we do that the X86_64 binaries we build would not preclude someone using us from making use of those features. (if they compiled all the rest of their stuff with it)",
      "parentUuid": "2fbeb31f_6a5498db",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "22f92a47_2a449d2e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-07-06T19:14:07Z",
      "side": 1,
      "message": "Played around with this and filed https://bugs.chromium.org/p/boringssl/issues/detail?id\u003d627 with notes for how to test this on CI.",
      "parentUuid": "436cecaf_75e7f4f5",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "15f9d059_c7815193",
        "filename": "crypto/chacha/asm/chacha-x86_64.pl",
        "patchSetId": 2
      },
      "lineNbr": 234,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-06-13T19:40:49Z",
      "side": 1,
      "message": "Arguably, we don\u0027t need this on all our functions, just the ones that are called through a function pointer. (Direct calls, AIUI, don\u0027t care.) But for the Arm feature, we opted to just mark all of them, which is probably easier. Especially given that testing this is a little hard and who knows what transforms the compiler will do, it\u0027s probably simpler to just mark function entrypoint.",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "96699ffa_24a46f47",
        "filename": "crypto/perlasm/x86_64-xlate.pl",
        "patchSetId": 2
      },
      "lineNbr": 1513,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-06-13T19:40:49Z",
      "side": 1,
      "message": "Optional: Would it make sense to merge this with the block above?",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ac0a5c05_013644da",
        "filename": "crypto/perlasm/x86_64-xlate.pl",
        "patchSetId": 2
      },
      "lineNbr": 1513,
      "author": {
        "id": 14196
      },
      "writtenOn": "2023-07-03T12:33:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "96699ffa_24a46f47",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b551e0e8_e4ab4559",
        "filename": "crypto/perlasm/x86_64-xlate.pl",
        "patchSetId": 2
      },
      "lineNbr": 1515,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-06-13T19:40:49Z",
      "side": 1,
      "message": "I assume we\u0027ll need to figure out the Windows convention for this eventually. :-)",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bf6558fb_5e924e14",
        "filename": "crypto/perlasm/x86_64-xlate.pl",
        "patchSetId": 2
      },
      "lineNbr": 1520,
      "author": {
        "id": 5415
      },
      "writtenOn": "2023-06-13T19:40:49Z",
      "side": 1,
      "message": "Looks like `\u003ccet.h\u003e` internally defines one of those marker sections too. Maybe we should put this in `\u003copenssl/asm_base.h\u003e` once this lands:\nhttps://boringssl-review.googlesource.com/c/boringssl/+/60765\n\nThat\u0027ll also make it work for non-perlasm files.",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "156f49d8_b3132168",
        "filename": "crypto/perlasm/x86_64-xlate.pl",
        "patchSetId": 2
      },
      "lineNbr": 1520,
      "author": {
        "id": 14196
      },
      "writtenOn": "2023-07-03T12:33:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bf6558fb_5e924e14",
      "revId": "0e446d92b15da4560e9938012d8b860d1c079065",
      "serverId": "66b711a4-aa9b-3dac-9062-916540830212"
    }
  ]
}